<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>ASB Members</title>
  </head>
  <body>
    <h1>ASB Members</h1>
    <table border="1" id="membersTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <script>
      const sheetUrl =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vS10OiVKg-emsE3HeMukI18ioBJ9bPIb90UtDNkVyk-kAsTGn_xbX5ZoAnYf4hrP1vWa-brAuVGGu1g/pub?output=csv";

      fetch(sheetUrl)
        .then((response) => response.text())
        .then((csvText) => {
          const rows = csvText.split("\n").map((row) => row.split(","));

          const headers = rows[0].map((h) => h.trim().replace(/^\uFEFF/, ""));

          console.log("Detected headers:", headers);

          const data = rows.slice(1).map((row) => {
            let obj = {};
            headers.forEach((header, i) => {
              obj[header] = row[i]?.trim() || "";
            });
            return obj;
          });

          data.forEach((student) => {
            const name = student[headers[0]];
            const student_id = student[headers[1]];
            let panel = student[headers[3]];
            const gsuite = student[headers[2]];

            if (panel.includes("~")) {
              const parts = panel.split("~");
              panel = parts[1].trim().toUpperCase();
            } else {
              panel = panel.trim().toUpperCase();
            }

            const tbody = document.querySelector("#membersTable tbody");

            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${name}</td>
              <td>${student_id}</td>
              <td>${gsuite}</td>
              <td>${panel}</td>
            `;
            tbody.appendChild(row);
          });
        })
        .catch((err) => console.error(err));
    </script>
    <!-- <script type="module">
 
    const tbody = document.querySelector("#membersTable tbody");

    asbMembers.forEach(member => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${member.Name}</td>
        <td>${member.Email}</td>
        <td>${member.Role}</td>
      `;
      tbody.appendChild(row);
    });
  </script> -->
  </body>
</html>
